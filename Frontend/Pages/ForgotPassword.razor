@page "/forgot-password"
@inject HttpClient Http
@inject NavigationManager Navigation

<div class="fullscreen-bg">
    <div class="login-card enhanced">
        <h2 class="login-title">Reset hasła</h2>

        @if (!string.IsNullOrEmpty(Error))
        {
            <p class="error">@Error</p>
        }

        <div class="input-wrapper">
            <i class="bi bi-envelope-fill input-icon"></i>
            <InputText class="input-field" @bind-Value="Email" placeholder="Adres e-mail" />
        </div>

        <button class="btn login-btn" @onclick="SendResetLink">Wyślij link resetujący</button>

        <div class="auth-links center-row" style="margin-top:1rem">
            <a href="/login">Powrót do logowania</a>
        </div>
    </div>
</div>

@code {
    string Email = "";
    string Error = "";

    private async Task SendResetLink()
    {
        Error = "";
        if (string.IsNullOrWhiteSpace(Email))
        {
            Error = "Podaj adres e-mail.";
            return;
        }

        // API zawsze zwraca 200, niezależnie od istnienia konta
        await Http.PostAsJsonAsync("/api/auth/request-password-reset", new { email = Email });

        Navigation.NavigateTo($"/reset-sent?email={Uri.EscapeDataString(Email)}");
    }
}